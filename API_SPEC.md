# Radio Review APIä»•æ§˜æ›¸

## èªè¨¼ã«ã¤ã„ã¦

ä¸€éƒ¨ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã¯èªè¨¼ãŒå¿…è¦ã§ã™ã€‚èªè¨¼ãŒå¿…è¦ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã¯ ğŸ”’ ãƒãƒ¼ã‚¯ãŒä»˜ã„ã¦ã„ã¾ã™ã€‚

**èªè¨¼æ–¹æ³•:**
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹èªè¨¼ï¼ˆLaravelæ¨™æº–ï¼‰
- CSRFãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦ï¼ˆPOSTãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ï¼‰

---

## ãŠæ°—ã«å…¥ã‚Šç•ªçµ„API ğŸ”’

### 1. ãŠæ°—ã«å…¥ã‚Šä¸€è¦§å–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /favorites`

**èª¬æ˜:** ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŠæ°—ã«å…¥ã‚Šç•ªçµ„ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

**èªè¨¼:** å¿…é ˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:** HTMLç”»é¢

---

### 2. ãŠæ°—ã«å…¥ã‚Šç™»éŒ²

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `POST /favorites`

**èª¬æ˜:** ç•ªçµ„ã‚’ãŠæ°—ã«å…¥ã‚Šã«ç™»éŒ²ã—ã¾ã™ã€‚

**èªè¨¼:** å¿…é ˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "station_id": "TBS",
  "program_title": "ã‚¢ãƒ•ã‚¿ãƒ¼6ã‚¸ãƒ£ãƒ³ã‚¯ã‚·ãƒ§ãƒ³"
}
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
| åå‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----|-----|------|-----|
| station_id | string | âœ“ | æ”¾é€å±€ID |
| program_title | string | âœ“ | ç•ªçµ„ã‚¿ã‚¤ãƒˆãƒ« |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "message": "ãŠæ°—ã«å…¥ã‚Šã«ç™»éŒ²ã—ã¾ã—ãŸ"
}
```

---

### 3. ãŠæ°—ã«å…¥ã‚Šå‰Šé™¤

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `POST /favorites/delete`

**èª¬æ˜:** ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã€‚

**èªè¨¼:** å¿…é ˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "id": 1
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "message": "ãŠæ°—ã«å…¥ã‚Šã‚’å‰Šé™¤ã—ã¾ã—ãŸ"
}
```

---

### 4. ãŠæ°—ã«å…¥ã‚Šç¢ºèª

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /favorites/check`

**èª¬æ˜:** æŒ‡å®šç•ªçµ„ãŒãŠæ°—ã«å…¥ã‚Šç™»éŒ²æ¸ˆã¿ã‹ç¢ºèªã—ã¾ã™ã€‚

**èªè¨¼:** å¿…é ˆ

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
| åå‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----|-----|------|-----|
| station_id | string | âœ“ | æ”¾é€å±€ID |
| program_title | string | âœ“ | ç•ªçµ„ã‚¿ã‚¤ãƒˆãƒ« |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "is_favorite": true
}
```

---

## éŒ²éŸ³äºˆç´„API ğŸ”’

### 1. éŒ²éŸ³äºˆç´„ä¸€è¦§å–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /recording/schedules`

**èª¬æ˜:** ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®éŒ²éŸ³äºˆç´„ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

**èªè¨¼:** å¿…é ˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:** HTMLç”»é¢

---

### 2. éŒ²éŸ³äºˆç´„ç™»éŒ²

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `POST /recording/schedule`

**èª¬æ˜:** ç•ªçµ„éŒ²éŸ³ã‚’äºˆç´„ã—ã¾ã™ã€‚

**èªè¨¼:** å¿…é ˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "station_id": "TBS",
  "program_title": "ã‚¢ãƒ•ã‚¿ãƒ¼6ã‚¸ãƒ£ãƒ³ã‚¯ã‚·ãƒ§ãƒ³",
  "scheduled_start_time": "20251003180000",
  "scheduled_end_time": "20251003190000"
}
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
| åå‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----|-----|------|-----|
| station_id | string | âœ“ | æ”¾é€å±€ID |
| program_title | string | âœ“ | ç•ªçµ„ã‚¿ã‚¤ãƒˆãƒ« |
| scheduled_start_time | string | âœ“ | é–‹å§‹æ™‚åˆ» (YmdHiså½¢å¼) |
| scheduled_end_time | string | âœ“ | çµ‚äº†æ™‚åˆ» (YmdHiså½¢å¼) |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "message": "éŒ²éŸ³äºˆç´„ã‚’ç™»éŒ²ã—ã¾ã—ãŸ"
}
```

**åˆ¶é™äº‹é …:**
- éŒ²éŸ³äºˆç´„ã¯1é€±é–“å…ˆã¾ã§

---

### 3. éŒ²éŸ³äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `POST /recording/schedule/cancel`

**èª¬æ˜:** éŒ²éŸ³äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã€‚

**èªè¨¼:** å¿…é ˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "schedule_id": 1
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "message": "äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ"
}
```

**æ³¨æ„:**
- pendingçŠ¶æ…‹ã®äºˆç´„ã®ã¿ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯èƒ½

---

## ã‚¿ã‚¤ãƒ ãƒ•ãƒªãƒ¼éŒ²éŸ³API

### 1. éŒ²éŸ³é–‹å§‹

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `POST /recording/timefree/start`

**èª¬æ˜:** radikoã®ã‚¿ã‚¤ãƒ ãƒ•ãƒªãƒ¼éŒ²éŸ³ã‚’é–‹å§‹ã—ã¾ã™ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "station_id": "TBS",
  "title": "ç•ªçµ„ã‚¿ã‚¤ãƒˆãƒ«",
  "start_time": "202509301200",
  "end_time": "202509301230"
}
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
| åå‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----|-----|------|-----|
| station_id | string | âœ“ | æ”¾é€å±€ID (ä¾‹: TBS, YFM) |
| title | string | âœ“ | ç•ªçµ„ã‚¿ã‚¤ãƒˆãƒ« |
| start_time | string | âœ“ | é–‹å§‹æ™‚åˆ» (YYYYMMDDHHmmå½¢å¼) |
| end_time | string | âœ“ | çµ‚äº†æ™‚åˆ» (YYYYMMDDHHmmå½¢å¼) |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "message": "ã‚¿ã‚¤ãƒ ãƒ•ãƒªãƒ¼éŒ²éŸ³ã‚’é–‹å§‹ã—ã¾ã—ãŸ",
  "recording_id": "TBS_202509301200_20250930163000",
  "filename": "TBS_202509301200_202509301230_20250930163000.m4a"
}
```

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": false,
  "message": "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
}
```

---

### 2. éŒ²éŸ³çŠ¶æ…‹ç¢ºèª

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /recording/status`

**èª¬æ˜:** éŒ²éŸ³ã®é€²æ—çŠ¶æ³ã‚’å–å¾—ã—ã¾ã™ã€‚

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
| åå‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----|-----|------|-----|
| recording_id | string | âœ“ | éŒ²éŸ³ID |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "status": "recording",
  "file_exists": true,
  "file_size": 1048576,
  "file_size_formatted": "1.0 MB",
  "elapsed_seconds": 30,
  "elapsed_time_formatted": "0:30",
  "planned_duration_minutes": 30,
  "progress_percentage": 50,
  "is_recording": true,
  "recording_info": {
    "station_id": "TBS",
    "title": "ç•ªçµ„ã‚¿ã‚¤ãƒˆãƒ«",
    "filename": "TBS_202509301200_202509301230_20250930163000.m4a",
    "filepath": "/path/to/file.m4a",
    "start_time": "202509301200",
    "end_time": "202509301230",
    "created_at": "2025-09-30T16:30:00.000000Z",
    "status": "recording"
  }
}
```

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:**
- `recording`: éŒ²éŸ³ä¸­
- `completed`: éŒ²éŸ³å®Œäº†

---

### 3. éŒ²éŸ³åœæ­¢

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `POST /recording/stop`

**èª¬æ˜:** é€²è¡Œä¸­ã®éŒ²éŸ³ã‚’åœæ­¢ã—ã¾ã™ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "recording_id": "TBS_202509301200_20250930163000"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "message": "éŒ²éŸ³ã‚’åœæ­¢ã—ã¾ã—ãŸ"
}
```

---

### 4. éŒ²éŸ³ä¸€è¦§å–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /recording/list`

**èª¬æ˜:** ã™ã¹ã¦ã®éŒ²éŸ³æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ï¼ˆJSONå½¢å¼ï¼‰ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "recordings": [
    {
      "station_id": "TBS",
      "title": "ç•ªçµ„ã‚¿ã‚¤ãƒˆãƒ«",
      "filename": "TBS_202509301200_202509301230_20250930163000.m4a",
      "filepath": "/path/to/file.m4a",
      "start_time": "202509301200",
      "end_time": "202509301230",
      "created_at": "2025-09-30T16:30:00.000000Z",
      "status": "completed"
    }
  ]
}
```

---

### 5. éŒ²éŸ³å±¥æ­´ç”»é¢è¡¨ç¤º

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /recording/history`

**èª¬æ˜:** éŒ²éŸ³å±¥æ­´ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§è¡¨ç¤ºã—ã¾ã™ï¼ˆHTMLå½¢å¼ï¼‰ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:** HTMLç”»é¢

**è¡¨ç¤ºå†…å®¹:**
- éŒ²éŸ³ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ï¼ˆæ”¾é€å±€ã€ç•ªçµ„åã€éŒ²éŸ³æ—¥æ™‚ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã€çŠ¶æ…‹ï¼‰
- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³
- å‰Šé™¤ãƒœã‚¿ãƒ³
- ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨çŠ¶æ³

---

### 6. ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /recording/download`

**èª¬æ˜:** éŒ²éŸ³æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
| åå‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----|-----|------|-----|
| recording_id | string | âœ“ | éŒ²éŸ³ID |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:** ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ˆaudio/mp4ï¼‰

---

### 7. éŒ²éŸ³ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `POST /recording/delete`

**èª¬æ˜:** éŒ²éŸ³ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥æƒ…å ±ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "recording_id": "TBS_202509301200_20250930163000"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "message": "éŒ²éŸ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¾ã—ãŸ"
}
```

---

## æŠ€è¡“ä»•æ§˜

### èªè¨¼
- ãŠæ°—ã«å…¥ã‚Šç•ªçµ„API: èªè¨¼å¿…é ˆ
- éŒ²éŸ³äºˆç´„API: èªè¨¼å¿…é ˆ
- ã‚¿ã‚¤ãƒ ãƒ•ãƒªãƒ¼éŒ²éŸ³API: ç¾åœ¨ã¯èªè¨¼ãªã—ï¼ˆå°†æ¥çš„ã«å®Ÿè£…äºˆå®šï¼‰
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹èªè¨¼ã‚’ä½¿ç”¨
- POST/DELETE/PUTãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¯CSRFãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦

### ãƒ¬ãƒ¼ãƒˆåˆ¶é™
radikoã‚µãƒ¼ãƒãƒ¼ã¸ã®è² è·ã‚’è€ƒæ…®ã—ã€ä»¥ä¸‹ã®åˆ¶é™ãŒã‚ã‚Šã¾ã™ï¼š
- ä¸¦åˆ—ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ•°: 10
- ãƒãƒ£ãƒ³ã‚¯é–“å¾…æ©Ÿæ™‚é–“: 0.2ç§’
- æ¥ç¶šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 30ç§’

### ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰
| ã‚³ãƒ¼ãƒ‰ | èª¬æ˜ |
|-------|-----|
| 200 | æˆåŠŸ |
| 400 | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸æ­£ |
| 404 | ãƒ•ã‚¡ã‚¤ãƒ«/éŒ²éŸ³æƒ…å ±ãŒè¦‹ã¤ã‹ã‚‰ãªã„ |
| 500 | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ |

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥
éŒ²éŸ³æƒ…å ±ã¯Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«2æ™‚é–“ä¿å­˜ã•ã‚Œã¾ã™ã€‚
ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼å½¢å¼: `recording_{recording_id}`

---

## ä½¿ç”¨ä¾‹

### JavaScript (Fetch API)

```javascript
// éŒ²éŸ³é–‹å§‹
const startRecording = async () => {
  const response = await fetch('/recording/timefree/start', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content
    },
    body: JSON.stringify({
      station_id: 'TBS',
      title: 'ãƒ†ã‚¹ãƒˆç•ªçµ„',
      start_time: '202509301200',
      end_time: '202509301230'
    })
  });

  const data = await response.json();
  console.log(data.recording_id);
};

// é€²æ—ç¢ºèª
const checkProgress = async (recordingId) => {
  const response = await fetch(`/recording/status?recording_id=${recordingId}`);
  const data = await response.json();
  console.log(`é€²æ—: ${data.progress_percentage}%`);
};

// ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
const downloadRecording = (recordingId) => {
  window.location.href = `/recording/download?recording_id=${recordingId}`;
};
```

### cURL

```bash
# éŒ²éŸ³é–‹å§‹
curl -X POST https://radio-review.com/recording/timefree/start \
  -H "Content-Type: application/json" \
  -d '{
    "station_id": "TBS",
    "title": "ãƒ†ã‚¹ãƒˆç•ªçµ„",
    "start_time": "202509301200",
    "end_time": "202509301230"
  }'

# é€²æ—ç¢ºèª
curl "https://radio-review.com/recording/status?recording_id=TBS_202509301200_20250930163000"

# ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
curl -O "https://radio-review.com/recording/download?recording_id=TBS_202509301200_20250930163000"
```

---

## æ›´æ–°å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|----------|------|---------|
| 1.0.0 | 2025-09-30 | åˆç‰ˆãƒªãƒªãƒ¼ã‚¹ |